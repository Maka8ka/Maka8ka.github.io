<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> CobaltStrike 4.3 破解 修复暗桩 | Maka8ka&#39;s Garden</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="CobaltStrike 4.3 破解 修复暗桩" />
<meta property="og:description" content="CobaltStrike 4.3 破解 修复暗桩 关键词: CobaltStrike
记录过程，自己动手，丰衣足食
破解目标
 替换authkey.pub文件 修改源码中authkay.pub的md5值 修改过期时间 修复becon/BeaconData.class中暗桩  破解第一步，反编译,Reserve_Cobalt_src目录需自行创建，否则会报目录不存在错误，出现其他错误更换Java版本，比如
Error: A JNI error has occurred, please check your installation and try again 使用Idea自带的反编译工具" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.maka8ka.cc/post/cobaltstrike-4-3-%E7%A0%B4%E8%A7%A3-%E4%BF%AE%E5%A4%8D%E6%9A%97%E6%A1%A9/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-05-01T12:22:41&#43;00:00" />
<meta property="article:modified_time" content="2021-05-01T12:22:41&#43;00:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CobaltStrike 4.3 破解 修复暗桩"/>
<meta name="twitter:description" content="CobaltStrike 4.3 破解 修复暗桩 关键词: CobaltStrike
记录过程，自己动手，丰衣足食
破解目标
 替换authkey.pub文件 修改源码中authkay.pub的md5值 修改过期时间 修复becon/BeaconData.class中暗桩  破解第一步，反编译,Reserve_Cobalt_src目录需自行创建，否则会报目录不存在错误，出现其他错误更换Java版本，比如
Error: A JNI error has occurred, please check your installation and try again 使用Idea自带的反编译工具"/>

  
  
    
  
  
  <link rel="stylesheet" href="https://www.maka8ka.cc/css/style-white.css">
  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://www.maka8ka.cc/images/favicon.ico" />

  
  
  
  
  
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RFYM27MKD6"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-RFYM27MKD6', { 'anonymize_ip': false });
}
</script>

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

    <header id="header">
  <a href="https://www.maka8ka.cc/">
  
    <div id="logo" style="background-image: url(https://www.maka8ka.cc/images/logo.png)"></div>
  
  <div id="title">
    <h1>Maka8ka&#39;s Garden</h1>
  </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#" aria-label="Menu"><i class="fas fa-bars fa-2x" aria-hidden="true"></i></a>
      </li>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/post/">Posts</a></li>
      
        <li><a href="/categories/">Categories</a></li>
      
        <li><a href="https://github.com/Maka8ka">Github</a></li>
      
    </ul>
  </div>
</header>



    
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <div class="content" itemprop="articleBody">
  
    <h1 id="cobaltstrike-43-破解-修复暗桩">CobaltStrike 4.3 破解 修复暗桩</h1>
<p>关键词: CobaltStrike</p>
<!-- raw HTML omitted -->
<p>记录过程，自己动手，丰衣足食</p>
<p>破解目标</p>
<ul>
<li>替换authkey.pub文件</li>
<li>修改源码中authkay.pub的md5值</li>
<li>修改过期时间</li>
<li>修复becon/BeaconData.class中暗桩</li>
</ul>
<!-- raw HTML omitted -->
<p>破解第一步，反编译,Reserve_Cobalt_src目录需自行创建，否则会报目录不存在错误，出现其他错误更换Java版本，比如</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Error: A JNI error has occurred, please check your installation and try again
</code></pre></div><p>使用Idea自带的反编译工具</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">java -cp <span style="color:#e6db74">&#34;C:\Program Files\JetBrains\IntelliJ IDEA 2021.1.1\plugins\java-decompiler\lib\java-decompiler.jar&#34;</span> org.jetbrains.java.decompiler.main.decompiler.ConsoleDecompiler -dgs<span style="color:#f92672">=</span>true cobaltstrike.jar Reserve_Cobalt_src
</code></pre></div><p>破解第二步</p>
<p>新建Idea项目-导入原版cobaltstrike.jar和反编译的源码。结构如下</p>
<p><img src="/images/CobaltStrike-2021-0501/Untitled.png" alt="/images/CobaltStrike-2021-0501/Untitled.png"></p>
<p>lib中使用原版</p>
<p>Reserve_Cobalt_src中存放反编译源码</p>
<p>src中存放修改过后的源码，建议使用到什么源码文件，从Reserve文件夹中拷贝重构，不然所有代码中有因Java版本及语法兼容问题导致构建不通过</p>
<p>破解第三步：</p>
<p>修改文件→项目结构如下</p>
<p><img src="/images/CobaltStrike-2021-0501/Untitled%201.png" alt="/images/CobaltStrike-2021-0501/Untitled%201.png"></p>
<p><img src="/images/CobaltStrike-2021-0501/Untitled%202.png" alt="/images/CobaltStrike-2021-0501/Untitled%202.png"></p>
<p>修改运行配置</p>
<p><img src="/images/CobaltStrike-2021-0501/Untitled%203.png" alt="/images/CobaltStrike-2021-0501/Untitled%203.png"></p>
<p>破解第四步</p>
<p>从反编译源码中获取如下java源文件放入src目录，目录对应好</p>
<p><img src="/images/CobaltStrike-2021-0501/Untitled%204.png" alt="/images/CobaltStrike-2021-0501/Untitled%204.png"></p>
<p>破解第五步</p>
<p>快去看破解原理？</p>
<p>破解原理及加密算法分析参考</p>
<p><a href="https://rcoil.me/2020/11/%E3%80%90%E7%9F%A5%E8%AF%86%E5%9B%9E%E9%A1%BE%E3%80%91Cobalt%20Strike%204.0%E8%AE%A4%E8%AF%81%E5%8F%8A%E4%BF%AE%E8%A1%A5%E8%BF%87%E7%A8%8B/">https://rcoil.me/2020/11/【知识回顾】Cobalt Strike 4.0认证及修补过程/</a></p>
<p>使用其代码</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">package KeyGen;

import common.CommonUtils;

import javax.crypto.BadPaddingException;
import javax.crypto.Cipher;
import javax.crypto.IllegalBlockSizeException;
import javax.crypto.NoSuchPaddingException;
import java.io.*;
import java.security.*;
import java.util.Base64;

public class RSAKeyPairGenerator <span style="color:#f92672">{</span>
    private PrivateKey privateKey;
    private PublicKey publicKey;

    public RSAKeyPairGenerator<span style="color:#f92672">()</span> throws NoSuchAlgorithmException <span style="color:#f92672">{</span>
        KeyPairGenerator keyGen <span style="color:#f92672">=</span> KeyPairGenerator.getInstance<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;RSA&#34;</span><span style="color:#f92672">)</span>;
        keyGen.initialize<span style="color:#f92672">(</span>2048<span style="color:#f92672">)</span>;
        KeyPair pair <span style="color:#f92672">=</span> keyGen.generateKeyPair<span style="color:#f92672">()</span>;
        this.privateKey <span style="color:#f92672">=</span> pair.getPrivate<span style="color:#f92672">()</span>;
        this.publicKey <span style="color:#f92672">=</span> pair.getPublic<span style="color:#f92672">()</span>;
    <span style="color:#f92672">}</span>

    // 将byte 写入文件
    public void byte2File<span style="color:#f92672">(</span>String path, byte<span style="color:#f92672">[]</span> data<span style="color:#f92672">)</span> throws IOException <span style="color:#f92672">{</span>
        File f <span style="color:#f92672">=</span> new File<span style="color:#f92672">(</span>path<span style="color:#f92672">)</span>;
        f.getParentFile<span style="color:#f92672">()</span>.mkdirs<span style="color:#f92672">()</span>;

        FileOutputStream fos <span style="color:#f92672">=</span> new FileOutputStream<span style="color:#f92672">(</span>f<span style="color:#f92672">)</span>;
        fos.write<span style="color:#f92672">(</span>data<span style="color:#f92672">)</span>;
        fos.flush<span style="color:#f92672">()</span>;
        fos.close<span style="color:#f92672">()</span>;
    <span style="color:#f92672">}</span>

    public PrivateKey getPrivateKey<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> privateKey;
    <span style="color:#f92672">}</span>

    public PublicKey getPublicKey<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> publicKey;
    <span style="color:#f92672">}</span>

    // 加密数据
    public byte<span style="color:#f92672">[]</span> encryptPri<span style="color:#f92672">(</span>byte<span style="color:#f92672">[]</span> data, PrivateKey privateKey<span style="color:#f92672">)</span> throws BadPaddingException, IllegalBlockSizeException, InvalidKeyException, NoSuchPaddingException, NoSuchAlgorithmException <span style="color:#f92672">{</span>
        Cipher cipher <span style="color:#f92672">=</span> Cipher.getInstance<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;RSA/ECB/PKCS1Padding&#34;</span><span style="color:#f92672">)</span>;
        cipher.init<span style="color:#f92672">(</span>Cipher.ENCRYPT_MODE, this.privateKey<span style="color:#f92672">)</span>;
        <span style="color:#66d9ef">return</span> cipher.doFinal<span style="color:#f92672">(</span>data<span style="color:#f92672">)</span>;
    <span style="color:#f92672">}</span>

    public static void main<span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> throws NoSuchAlgorithmException, IOException, IllegalBlockSizeException, InvalidKeyException, NoSuchPaddingException, BadPaddingException <span style="color:#f92672">{</span>
        RSAKeyPairGenerator PairGenerator <span style="color:#f92672">=</span> new RSAKeyPairGenerator<span style="color:#f92672">()</span>;
        byte<span style="color:#f92672">[]</span> data <span style="color:#f92672">=</span> <span style="color:#f92672">{</span> -54, -2, -64, -45, 0, 43, 1, -55, -61, 127, 0, 0, 34, -112, 127, 16, 27, -27, -66, 82, -58, 37, 92, 51, 85, -114, -118, 28, -74, 103, -53, <span style="color:#ae81ff">6</span> <span style="color:#f92672">}</span>;
        byte<span style="color:#f92672">[]</span> rsaByte <span style="color:#f92672">=</span> PairGenerator.encryptPri<span style="color:#f92672">(</span>data, PairGenerator.getPrivateKey<span style="color:#f92672">())</span>;
        PairGenerator.byte2File<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;RSA/cobaltstrike.auth&#34;</span>, rsaByte<span style="color:#f92672">)</span>;
        PairGenerator.byte2File<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;RSA/authkey.private&#34;</span>, PairGenerator.getPrivateKey<span style="color:#f92672">()</span>.getEncoded<span style="color:#f92672">())</span>;
        PairGenerator.byte2File<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;RSA/authkey.pub&#34;</span>, PairGenerator.getPublicKey<span style="color:#f92672">()</span>.getEncoded<span style="color:#f92672">())</span>;
        byte<span style="color:#f92672">[]</span> var1 <span style="color:#f92672">=</span> CommonUtils.readAll<span style="color:#f92672">(</span>CommonUtils.class.getClassLoader<span style="color:#f92672">()</span>.getResourceAsStream<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;resources/authkey.pub&#34;</span><span style="color:#f92672">))</span>;
        byte<span style="color:#f92672">[]</span> var2 <span style="color:#f92672">=</span> CommonUtils.MD5<span style="color:#f92672">(</span>var1<span style="color:#f92672">)</span>;
        CommonUtils.toHex<span style="color:#f92672">(</span>var2<span style="color:#f92672">)</span>;
        System.out.println<span style="color:#f92672">(</span>CommonUtils.toHex<span style="color:#f92672">(</span>var2<span style="color:#f92672">))</span>; //此处打印md5值
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>将生成的authkey.pub放到/src/resources/authkey.pub</p>
<p>破解第六步</p>
<p>修改源码</p>
<p>AuthCrypto.java  此处修改md5为上述java文件中打印的md5值</p>
<p><img src="/images/CobaltStrike-2021-0501/Untitled%205.png" alt="/images/CobaltStrike-2021-0501/Untitled%205.png"></p>
<p>Authorization.java 修复验证过期</p>
<p><img src="/images/CobaltStrike-2021-0501/Untitled%206.png" alt="/images/CobaltStrike-2021-0501/Untitled%206.png"></p>
<p>src/beacon/BeaconData.java 修复自动退出beacon的问题</p>
<p><img src="/images/CobaltStrike-2021-0501/Untitled%207.png" alt="/images/CobaltStrike-2021-0501/Untitled%207.png"></p>
<p>接下来就打包编译，愉快的CSgo</p>
<p>原版验证地址:</p>
<p><a href="https://verify.cobaltstrike.com/">https://verify.cobaltstrike.com/</a></p>
<p>原版下载地址:</p>
<p><a href="/images/CobaltStrike-2021-0501/downloads/cobaltstrike4.3mar.17.2021offical.jar">下载链接</a></p>
<p>参考与致谢:</p>
<p><a href="https://rcoil.me/2020/11/%E3%80%90%E7%9F%A5%E8%AF%86%E5%9B%9E%E9%A1%BE%E3%80%91Cobalt%20Strike%204.0%E8%AE%A4%E8%AF%81%E5%8F%8A%E4%BF%AE%E8%A1%A5%E8%BF%87%E7%A8%8B/">https://rcoil.me/2020/11/【知识回顾】Cobalt Strike 4.0认证及修补过程/</a></p>
<p><a href="https://www.cnblogs.com/ssooking/p/12535998.html">https://www.cnblogs.com/ssooking/p/12535998.html</a></p>
<p>本文内容仅做技术研究使用，禁止使用工具对他人造成攻击。</p>

  
  </div>
</article>


    <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2021  Maka8ka 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/post/">Posts</a></li>
         
        <li><a href="/categories/">Categories</a></li>
         
        <li><a href="https://github.com/Maka8ka">Github</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
</html>
